<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Добавить новое событие</title>
  <link rel="stylesheet" href="../Loom/models-TaskAndEdit.css">
</head>
<body>
  <div class="privacy-notification" id="privacyNotification">
    <div class="privacy-notification-text">
      Вы сделали событие приватным, другие члены семьи не увидят его в семейном календаре
    </div>
  </div>
  <div class="participant-notification" id="participantNotification">
    <div class="participant-notification-text">Ждите ответ от пользователя(-ей)</div>
  </div>
  <button class="open-modal-btn" id="openModalBtn">Добавить событие</button>
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <button class="close-btn" id="closeModalBtn" title="Закрыть"></button>
      <h2>Добавьте новое событие</h2>
      <input type="text" class="event-title" placeholder="Название" />

      <div class="modal-card time-container">
        <div class="time-header">
            <div class="time-label-container">
                <span class="time-icon"></span>
                <span class="time-label-text">Дата & Время</span>
            </div>
            
            <div class="timezone-custom-select">
              <div class="timezone-selected" id="timezoneSelected">Часовой пояс</div>
              <div class="timezone-options" id="timezoneOptions">
                <div class="timezone-option" data-value="UTC+2">UTC+2</div>
                <div class="timezone-option" data-value="UTC+3">UTC+3</div>
                <div class="timezone-option" data-value="UTC+4">UTC+4</div>
                <div class="timezone-option" data-value="UTC+5">UTC+5</div>
                <div class="timezone-option" data-value="UTC+6">UTC+6</div>
                <div class="timezone-option" data-value="UTC+7">UTC+7</div>
                <div class="timezone-option" data-value="UTC+8">UTC+8</div>
                <div class="timezone-option" data-value="UTC+9">UTC+9</div>
                <div class="timezone-option" data-value="UTC+10">UTC+10</div>
                <div class="timezone-option" data-value="UTC+11">UTC+11</div>
                <div class="timezone-option" data-value="UTC+12">UTC+12</div>
              </div>
            </div>
        </div>
        
        <hr class="time-divider">
        
        <div class="time-content">
            <div class="date-container">
                <label class="date-label">Дата события</label>
                <input type="text" class="date-input" placeholder="ДД.ММ.ГГГГ" maxlength="10" />
            </div>
            
            <div class="time-range-container">
              <div class="time-input-container">
                  <label class="time-input-label">Начало</label>
                  <input type="text" class="time-input" id="startTime" placeholder="00:00" maxlength="5">
              </div>
              <div class="time-input-container">
                  <label class="time-input-label">Конец</label>
                  <input type="text" class="time-input" id="endTime" placeholder="00:00" maxlength="5">
              </div>
          </div>
        </div>
    </div>

    <div class="modal-card">
      <button class="category-toggle" id="categoryToggle" type="button">
        <div class="category-content">
          <span class="category-icon"></span>
          <span class="category-label" id="categoryLabel">Выбрать тему</span>
          <span class="selected-category-dot" id="selectedCategoryDot"></span>
        </div>
        <span class="category-arrow" id="categoryArrow"></span>
      </button>
      <div class="category-list" id="categoryList">
        <div class="category-item" data-value="Работа/Учёба">
          <span class="checkbox-icon"></span>
          <span>Работа/Учёба</span>
          <span class="category-dot blue"></span>
        </div>
        <div class="category-item" data-value="Бытовые дела">
          <span class="checkbox-icon"></span>
          <span>Бытовые дела</span>
          <span class="category-dot purple"></span>
        </div>
        <div class="category-item" data-value="Время, проведённое с семьёй">
          <span class="checkbox-icon"></span>
          <span>Время, проведённое с семьёй</span>
          <span class="category-dot green"></span>
        </div>
        <div class="category-item" data-value="Время, проведённое с друзьями">
          <span class="checkbox-icon"></span>
          <span>Время, проведённое с друзьями</span>
          <span class="category-dot orange"></span>
        </div>
        <div class="category-item" data-value="Личные дела">
          <span class="checkbox-icon"></span>
          <span>Личные дела</span>
          <span class="category-dot red"></span>
        </div>
        <div class="category-item" data-value="Праздники">
          <span class="checkbox-icon"></span>
          <span>Праздники</span>
          <span class="category-dot yellow"></span>
        </div>
      </div>
    </div>

      <div class="modal-card participants-section">
        <div class="participants-header">
          <button class="add-participant-btn" id="addParticipantBtn" type="button">
            <span class="participants-icon"></span>
            <span class="participants-label" id="participantsLabel">Добавить участников</span>
          </button>
          
        </div>
        <div class="participants-list" id="participantsList">
          <!-- <span class="participant-chip">Маша <button class="participant-remove" data-name="Маша"></button></span>
          <span class="participant-chip">Павел <button class="participant-remove" data-name="Павел"></button></span>
          <span class="participant-chip">Елена <button class="participant-remove" data-name="Елена"></button></span> -->
        </div>
      </div>

      <div class="private-section">
        <div class="private-container">
          <span class="private-icon"></span>
          <span class="private-label">Сделать событие приватным</span>
          <button class="private-checkbox" id="privateCheckbox"></button>
        </div>
      </div>

      <div class="repeat-section">
        <div class="repeat-header">
          <div class="repeat-icon-container">
            <span class="repeat-icon"></span>
            <span class="repeat-label">Повторяющийся</span>
          </div>
        </div>
        
        <hr class="repeat-divider">
        
        <div class="repeat-days-container">
          <span class="repeat-on-label">На</span>
          <div class="repeat-days" id="repeatDays">
            <div class="repeat-day">Пн</div>
            <div class="repeat-day">Вт</div>
            <div class="repeat-day">Ср</div>
            <div class="repeat-day">Чт</div>
            <div class="repeat-day">Пт</div>
            <div class="repeat-day saturday">Сб</div>
            <div class="repeat-day sunday">Вс</div>
          </div>
        </div>
        
        <div class="repeat-options-container">
          <span class="repeat-on-label">На</span>
          <div class="repeat-options-container" id="repeatOptions">
            <div class="repeat-option">Ежедневно</div>
            <div class="repeat-option">Ежемесячно</div>
            <div class="repeat-option">Ежегодно</div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelBtn">Отменить</button>
        <button class="modal-btn save">
          <span class="save-btn-text">Сохранить</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Открытие/закрытие модального окна
const openBtn = document.getElementById('openModalBtn');
const modalOverlay = document.getElementById('modalOverlay');
const closeBtn = document.getElementById('closeModalBtn');
const cancelBtn = document.getElementById('cancelBtn');

openBtn.onclick = () => {
  modalOverlay.classList.add('active');
  resetFormStyles();
};

closeBtn.onclick = closeModal;
cancelBtn.onclick = closeModal;

window.onclick = (e) => {
  if (e.target === modalOverlay) {
    closeModal();
  }
};

function closeModal() {
  modalOverlay.classList.remove('active');
}

// Сброс стилей формы
function resetFormStyles() {
  document.querySelector('.event-title').style.border = '0.5px solid rgba(197, 197, 197, 0.5)';
  document.querySelector('.date-input').style.border = '0.6px solid rgba(197, 197, 197, 1)';
  document.querySelectorAll('.time-input').forEach(input => {
    input.style.border = '0.6px solid rgba(197, 197, 197, 1)';
  });
  document.querySelector('.timezone-selected').style.border = '0.6px solid rgba(197, 197, 197, 1)';
  document.querySelector('.timezone-selected').style.color = 'rgba(126, 126, 126, 1)';
  document.querySelector('.timezone-selected').dataset.value = "";
  document.querySelector('.category-toggle').style.border = '0.5px solid rgba(197, 197, 197, 0.5)';
  document.querySelector('.private-container').style.border = '0.5px solid rgba(197, 197, 197, 0.5)';
}

// Обработка полей формы
document.querySelector('.event-title').addEventListener('input', function() {
  this.style.border = this.value.trim() ? 
    '0.5px solid rgba(60, 60, 88, 1)' : 
    '0.5px solid rgba(197, 197, 197, 0.5)';
});

document.querySelector('.date-input').addEventListener('input', function() {
  this.style.border = this.value.trim() ? 
    '0.5px solid rgba(60, 60, 88, 1)' : 
    '0.6px solid rgba(197, 197, 197, 1)';
});

// Обработка времени
function formatTimeInput(input) {
  let value = input.value.replace(/\D/g, '');
  if (value.length > 2) {
    value = value.substring(0, 2) + ':' + value.substring(2);
  }
  if (value.length > 5) {
    value = value.substring(0, 5);
  }
  input.value = value;
}

function validateTime(input) {
  const timeParts = input.value.split(':');
  if (timeParts.length === 2) {
    
    if (hours > 23) hours = 23;
    if (minutes > 59) minutes = 59;
    
    input.value = (hours < 10 ? '0' + hours : hours) + ':' + 
                 (minutes < 10 ? '0' + minutes : minutes);
  }
}

document.getElementById('startTime').addEventListener('input', function() {
  formatTimeInput(this);
  validateTime(this);
  this.style.border = this.value.trim() ? 
    '0.5px solid rgba(60, 60, 88, 1)' : 
    '0.6px solid rgba(197, 197, 197, 1)';
});

document.getElementById('endTime').addEventListener('input', function() {
  formatTimeInput(this);
  validateTime(this);
  this.style.border = this.value.trim() ? 
    '0.5px solid rgba(60, 60, 88, 1)' : 
    '0.6px solid rgba(197, 197, 197, 1)';
});

// Запрет нецифрового ввода для времени
document.querySelectorAll('.time-input').forEach(input => {
  input.addEventListener('keydown', function(e) {
    if ([46, 8, 9, 27, 13].includes(e.keyCode) || 
        (e.keyCode === 65 && e.ctrlKey) || 
        (e.keyCode === 67 && e.ctrlKey) ||
        (e.keyCode === 86 && e.ctrlKey) ||
        (e.keyCode === 88 && e.ctrlKey) ||
        (e.keyCode >= 35 && e.keyCode <= 39)) {
      return;
    }
    if ((e.keyCode < 48 || e.keyCode > 57) && (e.keyCode < 96 || e.keyCode > 105)) {
      e.preventDefault();
    }
  });
});

// Часовой пояс
const timezoneSelected = document.getElementById('timezoneSelected');
const timezoneOptions = document.getElementById('timezoneOptions');
const timezoneContainer = document.querySelector('.timezone-custom-select');

timezoneSelected.addEventListener('click', function() {
  timezoneContainer.classList.toggle('active');
});

document.querySelectorAll('.timezone-option').forEach(option => {
  option.addEventListener('click', function() {
    timezoneSelected.textContent = this.textContent;
    timezoneSelected.dataset.value = "selected";
    timezoneContainer.classList.remove('active');
    timezoneSelected.style.border = '0.5px solid rgba(60, 60, 88, 1)';
    timezoneSelected.style.color = 'rgba(60, 60, 88, 1)';
  });
});

document.addEventListener('click', function(e) {
  if (!timezoneContainer.contains(e.target)) {
    timezoneContainer.classList.remove('active');
  }
});

// Категории
const categoryList = document.getElementById('categoryList');
const categoryLabel = document.getElementById('categoryLabel');
const selectedCategoryDot = document.getElementById('selectedCategoryDot');
const categoryToggle = document.getElementById('categoryToggle');
const categoryArrow = document.getElementById('categoryArrow');

function toggleCategoryList() {
  const isOpen = categoryList.style.display === 'block';
  categoryList.style.display = isOpen ? 'none' : 'block';
  categoryArrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
  categoryArrow.style.transition = 'transform 0.2s ease';
}

categoryToggle.addEventListener('click', function(e) {
  if (e.target === categoryArrow || e.target.classList.contains('category-arrow')) {
    toggleCategoryList();
    e.stopPropagation();
  } else if (!e.target.closest('.category-item')) {
    toggleCategoryList();
  }
});

categoryList.addEventListener('click', function(e) {
  const item = e.target.closest('.category-item');
  if (item) {
    document.querySelectorAll('.category-item').forEach(el => el.classList.remove('selected'));
    item.classList.add('selected');
    
    const categoryName = item.getAttribute('data-value');
    const dotColor = item.querySelector('.category-dot').className.split(' ')[1];
    
    categoryLabel.textContent = categoryName;
    categoryToggle.classList.add('has-selection');
    selectedCategoryDot.className = 'selected-category-dot ' + dotColor;
    selectedCategoryDot.style.display = 'inline-block';
    categoryToggle.style.border = '0.5px solid rgba(60, 60, 88, 1)';
    
    toggleCategoryList();
  }
});

document.addEventListener('click', function(e) {
  if (!categoryToggle.contains(e.target) && !e.target.closest('.category-list')) {
    categoryList.style.display = 'none';
    categoryArrow.style.transform = 'rotate(0deg)';
  }
});

// Участники с уведомлением
const participantsList = document.getElementById('participantsList');
const participantNotification = document.getElementById('participantNotification');

document.getElementById('addParticipantBtn').onclick = function() {
  const name = prompt('Введите имя участника:');
  if (name && name.trim()) {
    const chip = document.createElement('span');
    chip.className = 'participant-chip';
    chip.innerHTML = `${name} <button class="participant-remove" data-name="${name}"></button>`;
    participantsList.appendChild(chip);
    
    // Показываем уведомление
    participantNotification.classList.add('show');
    
    // Скрываем уведомление через 3 секунды
    setTimeout(() => {
      participantNotification.classList.remove('show');
    }, 3000);
  }
};

participantsList.addEventListener('click', function(e) {
  if (e.target.classList.contains('participant-remove')) {
    e.target.parentElement.remove();
  }
});

// Приватность с уведомлением
const privateCheckbox = document.getElementById('privateCheckbox');
const privateContainer = document.querySelector('.private-container');
const privacyNotification = document.getElementById('privacyNotification');

privateContainer.addEventListener('click', function() {
  const isChecked = !privateCheckbox.classList.contains('checked');
  
  privateCheckbox.classList.toggle('checked');
  this.classList.toggle('checked');
  this.style.border = isChecked 
    ? '0.5px solid rgba(60, 60, 88, 1)' 
    : '0.5px solid rgba(197, 197, 197, 0.5)';
  
  // Если установили галочку приватности
  if (isChecked) {
    // Удаляем всех участников
    participantsList.innerHTML = '';
    
    // Показываем уведомление
    privacyNotification.classList.add('show');
    
    // Скрываем уведомление через 3 секунды
    setTimeout(() => {
      privacyNotification.classList.remove('show');
    }, 3000);
  }
});

// Повторяемость
const repeatOptions = document.getElementById('repeatOptions');
repeatOptions.onclick = function(e) {
  if (e.target.classList.contains('repeat-option')) {
    if (e.target.classList.contains('selected')) {
      e.target.classList.remove('selected');
    } else {
      document.querySelectorAll('.repeat-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      e.target.classList.add('selected');
    }
  }
};

const repeatDays = document.getElementById('repeatDays');
repeatDays.onclick = function(e) {
  if (e.target.classList.contains('repeat-day')) {
    e.target.classList.toggle('selected');
  }
};

  </script>
</body>
</html>